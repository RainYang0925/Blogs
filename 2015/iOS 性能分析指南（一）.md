下文翻译自苹果官方文档，如需转载请注明来源。

#1.什么是性能
『性能』不是仅仅考虑 APP 运行的速度，因为 APP 所运行的 OS 运行情况并不是固定的值，如果在相同的 OS 以不同的场景运行同一个 APP，运行状况可能会差别很大。因为 APP 只是 OS 上所运行众多进程中的一个，某个进程对资源的影响会影响到其他进程。

性能的概念可以理解为：高效的资源利用和感觉到的表现情况。

##高效的资源利用
计算机对所有运行中的进程共享有限数量的资源，在最小程度上，可以把这些资源分解为以下几个分类：
>* CPU 时间
>* 内存空间
>* 大量存储空间

所有数据要么运行在内存中，要么运行在某种程度上的大量存储空间中，并通过 CPU 运行。高效的 APP 会小心的使用这些资源。下面的章节介绍一下这些资源的更多细节，和对 APP 的影响。

###CPU Time
CPU时间通过系统分发，因此你必须尽最大的努力来使用 CPU 所分配给的时间。OSX iOS都是对称多处理系统，系统中的每个线程都被分配一小段时间（最多10毫秒）来运行。这段时间结束后，系统收回 CPU 的控制权并把它分配给其他进程。

在一个典型的运行着多个活跃进程的系统中，如果每个进程都完全用尽所分配给它的时间，性能就会变得很差。这就引出一个写 APP 时重要的目标：
`目标：任何时候尽你所能的把任务从 CPU 移除出去。`

想要了解一些关于如何高效利用 CPU 时间的基本信息可参考[基本优化 tips](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html).
想了解关于改进绘制操作速度可参考[Drawing Code](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html)

###内存空间
现代计算机硬件上的内存通常由较慢（但容量更大）的内存构成。CPU 所能使用的最快存储是 CPU 自己的寄存器。其次最快的是 L1缓存，再其次是可用的 L2\L3缓存。再其次最快的存储才是主内存。最慢的内存是由 OSX 上的虚拟内存页组成、存储在硬盘上的虚拟内存，并且在每次使用它们之前需要从磁盘转移到内存。

在理想的情况下，每个应用应该足够小到可以利用系统最快的缓存存储。但不幸的是，大多数的 APP 代码和数据存放于主内存或硬盘中。因此，对于 APP 代码和数据来说，通过某种组织方式，将其花费在最慢的存储媒介上的时间减少是很重要的。这就引出以下的目标：
`目标：减少 APP 的内存占用`
减少 APP 的内存占用可以显著提高性能表现。小的内存占用通常有两点好处。第一，占用越少，就会占用越少的内存页，内存页越少就意味着更少的分页操作。第二，作为优化和更好组织的结果，代码量通常会更少。这样就需要更少的指令来进行给定的任务，并且执行该任务的所有代码都在同一个内存页上。

另外为了减少 APP 的内存占用，应该再尝试减少 APP 对内存页的读写。可读写内存页存储全局或局部数据。在 OSX 中，如果需要的话这种页可以写入硬盘，但同时这么做会变慢。在 iOS 中，这些页需要APP 主动清理，这就需要 APP 稍后重新在这些页上创建数据。系统也需要花费时间来清理内存——这些时间用于执行APP 程序代码会更好。

一些基本信息关于如何节省占用参考[Application Footprint](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html)
特别关于如何更有效使用内存的 tips 见[Memory Allocation Code](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html)

###大规模存储空间
文件系统性能对于任何计算机来说都很重要。因为几乎所有东西都存储在某个文件中。你的应用、数据，甚至 OS 自身都存储于文件中，从某个设备上读取到内存里
，与系统其他部分相比要慢的多。文件系统，无论是本地还是基于网络，都是性能的最大的瓶颈。这就引出了另一个目标：
`目标：排除不需要的，并延迟其他的文件操作直到这些信息真的被需要`

通过排除不需要的或延迟文件操作对于消除性能瓶颈和改善你的应用的性能表现是很重要的。当从文件请求数据并在应用中展现时，会进行数以千万计的 CPU 循环。如果应用进行大量的文件操作，可能需要等待几秒来获取所有被请求的数据。

还有一件重要的事情，你的应用和它产生的任何文件可能存储在网络上，而不是在本地磁盘。特别是OSX让网络请求尽可能的不被察觉，因此不要只把文件假想为存储在本地。

一些关于如何提升基于文件性能的信息，参考[File Access Code](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html)

##感知速度
尽管你把代码调试到最优的性能，应用仍完全有可能向用户表现的非常慢。原因不可避免：如果你需要做很多事情，就需要占用 CPU 时间和资源。然而有一些事是你可以做的，来使你的应用速度表现更好，这就引出下面的目标：
`目标：让你的应用对于用户可响应`
可响应通常对于用户来说比纯粹的速度更重要。对于速度的感知通过让用户持续可操作的同时，你的应用在后台进行数据传输。改善应用并发任务数是提高响应的好办法。并发通常通过 GCD 或者 线程实现。当应用主线程用于响应用户时，分配子线程或后台线程来进行计算或其他耗时任务。

另一种常用的方式使你的应用表现的快是提高启动时间。应用启动超过1-2秒可能就太多了。不仅这段时间对于用户是不可操作的，并且这段时间还用来加载并不马上需要使用的一些资源，这样就太浪费时间了。

一些关于如何提升启动时间参考[Launch Time Initialization Code.](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html).
关于改进感知性能可参考[Take Advantage of Perceived Performance](xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html)

#追踪性能
保证高性能的唯一方式是在产品设计和开发时制定性能目标并实施。高性能不是你可以在开发周期末尾时临时加上去的一块功能，而是紧密的贯穿于开发周期中的。写一段代码时，就要知道它对程序整体性能产生什么样的影响。如果可以很早发现性能问题，就有更充裕的时间来修复而不至于项目延期。

决定你是否达到或超过特定的目标，在于收集性能指标。苹果提供一些工具来监控和分析程序性能表现。你也可以在程序里直接加入性能测量工具来自动化收集和分析步骤。无论采用哪种方式，都需要定时运行这些工具并分析结果。

##建立基线指标
第一件事是你首先要确定需要哪些指标，选择那些对用户来说最重要的指标并设定执行这些任务的约束条件。例如，你或许希望你的应用在1秒内加载并显示首窗口，或者你希望保持整体内存使用率在一个特定的范围。

选择的指标应该反应你的用户需求。市场部门应该可以帮你选择一系列用户感觉有关的任务。如果你的产品非常稳定，可以通过跟用户沟通了解他们认为哪些地方比较慢，考虑提升这些功能模块的性能表现就是你接下来要做的事了。

一旦有了需要追踪的指标列表，就需要决定每项任务所需达到的目标。对于现有的产品，你或许只是希望相对于上一个版本有所改进。也可以对比竞品，设置达到或超过他们的目标。如果是新的产品，你或许可以通过经验来制定合理的目标。另外，也可以建立比较激进的指标来尽可能达到它。

稳定性测试也是很重要的，建立基线指标应该包括所运行的设备信息。记录硬件和软件设置的细节，保证每次测试都运行在相同的设置上。使用尽可能慢的硬件设置来建立基线，因为如果在快速的设备上测试会误导你相信自己的软件运行良好，但很多用户设备性能可能较低。

##尽早、尽快
性能数据不能运行一次就找到应用中所有性能瓶颈。如果保持产品一段时间的性能表现数据更能发现问题。保存历史数据便于观察应用性能提升还是下降。如果下降了，就在交付产品前进行优化。

有规律的衡量性能指标还有一个好处是你可以将结果与指定的代码签入相关联。如果在某个特定的里程碑性能下降了，你就可以去 review 这段时间签入的代码，查看由于哪些代码导致。同样的，如果性能提升了，你也可以把最近的代码作为好的代码经验分享给团队。

应该在进行一部分功能开发后就进行性能评估，当新功能被加入时，你可以对这些新功能增加评估。自动化检测性能可以让团队成员更容易的获得结果。让这些信息可读对代码签入前修复性能问题更有帮助。

##分析结果
收集数据是找到性能瓶颈最重要的步骤。一旦获取到性能数据，找到问题所在就变得至关重要。分析性能数据并不是简单的看一下输出结果就找到问题所在。有时可能很快的发现问题，但有些问题非常巧妙，需要更仔细的分析。

###分析高级算法
当你分析性能数据时，在分析问题时保持抽象思考。假设性能数据指示很多时间被花费在某个特定的方法中。可能这个方法中的某些代码可以被优化使性能表现更佳，但这真的是问题产生的原因吗？再次运行你的程序，但这次检查这个方法被调用的次数。如果这个方法被调用了百万次，问题可能出在这个方法所调用的更高级别的算法中。如果这个方法被调用一次，问题更可能出现在方法本身。

[Performance Tools]（xcdoc://?url=developer.apple.com/library/etc/redirect/xcode/ios/1048/documentation/Performance/Conceptual/PerformanceOverview/PerformanceTools/PerformanceTools.html）

性能工具本身存在一些限制，当你分析数据时需要注意这些。例如，工具可能指出你的应用耗费了很多时间，但你应该在得出结论前理解这些工具如何收集数据。工具不会追踪每一次方法调用。它们在应用运行时的固定间隔获取数据分析。把从这些工具获得的输出结果作为指导，但需要与你收集的其他数据一起分析。

###其他分析技术
如果你曾经对性能问题的真实原因产生怀疑，就要避免对问题原因过早下结论。将精力集中在对相关代码的数据收集上，尝试使用不同的工具来获取新类型的数据。另一种工具可能会给解决问题提供独特的视角。

还有一些方法可以帮助分析问题：
>* 在 debugger 中观察代码运行。通过 debugger 调试代码可能找到导致程序缓慢的逻辑问题。
>* 在代码中添加检查点，查看该段代码何时被执行。例如通过检查点来追踪初始化代码。
[the Launch Time Performance Guidelines]()
>* 尝试对问题进行不同的解决方案，看是否问题还会复现。